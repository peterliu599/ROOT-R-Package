---
title: "Data-generating process (DGP) of a Type 2 Diabetes Trial and its Target Population"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Data-generating process (DGP) of a Type 2 Diabetes Trial and its Target Population}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---



This vignette simulates a target population and a randomized trial that compares **Treatment 1** vs **Treatment 2** on 1-month blood sugar levels among people with type 2 diabetes.

- Covariates (all binary): `Race_Black`, `Sex_Male`, `DietYes`, `Age45`.
- Target prevalences: Black females = 20%; Diet yes = 10%; Age ≥ 45 = 15%.
- Trial imbalance: Black females are 5% in the trial ata but 20% in the target population.
- Data-generating process (ε ~ N(0,1)):

\[
Y \;=\; 1 + \text{Tr}\cdot(1 + 1.6\,\text{DietYes} + 1.3\,\text{Age45})
- 0.5\,\text{Race_Black} + 0.3\,\text{Sex_Male} + \text{DietYes} + \text{Age45} + \varepsilon,
\]
where Tr = 1 denotes Treatment 1 and Tr = 0 denotes Treatment 2.

We then run `ROOT()` and `characterizing_underrep()`.
```{r}
knitr::opts_chunk$set(
  echo = TRUE,
  fig.width  = 6,     # inches (pick a width your layout likes)
  fig.height = 5,     # inches
  fig.retina = 2,     # crisp in HTML; set to 1 if text looks oversized
  dpi        = 150,   # for raster devices
  dev        = "ragg_png"  # consistent sizing & font metrics (needs ragg)
)
library(ROOT)
load("../data/simulated_diabetes_data.rda")
head(simulated_diabetes_data)
trial  <- subset(simulated_diabetes_data, S == 1)
target <- subset(simulated_diabetes_data, S == 0)
```

## Visualize final characterized tree from Rashomon Set

```{r}
outputROOT.DGP <- ROOT(
  data           = simulated_diabetes_data,
  outcome        = "Y",
  treatment      = "Tr",
  sample         = "S",
  leaf_proba     = 0.25,
  seed           = 3,
  num_trees      = 50,
  vote_threshold = 2/3,
  explore_proba  = 0.05,
  feature_est    = "Ridge",
  top_k_trees    = FALSE,
  verbose        = TRUE,
  cutoff         = "baseline"
)
summary(outputROOT.DGP)
plot(outputROOT.DGP)
```

## Visualize underrepresented population in characterization tree

```{r}
### Run characterizing_underrep function
outputUnderrep.DGP <- characterizing_underrep(
  DataRCT               = trial,
  covariateColName_RCT  = c("Race_Black", "Sex_Male", "DietYes", "Age45"),
  trtColName_RCT        = "Tr",
  outcomeColName_RCT    = "Y",
  DataTarget            = target,
  covariateColName_TargetData  = c("Race_Black", "Sex_Male", "DietYes", "Age45"),
  num_trees             = 50,
  seed                  = 3,
  verbose               = TRUE
)
summary(outputUnderrep.DGP)
plot(outputUnderrep.DGP)
```
